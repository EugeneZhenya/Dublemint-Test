import{C as H,S as F,G as u,T as c,A as v,a as k,b as z}from"./index-D8KJZp8y.js";class _ extends H{constructor({width:t,height:e,symbolTextures:i}){super(),this.symbolTextures=i,this.symbolHeight=e/3,this.totalSymbols=10,this.centerIndex=1,this.symbolsContainer=new H,this.addChild(this.symbolsContainer),this.symbols=[];for(let r=0;r<this.totalSymbols;r++){const n=new F(this.getRandomTexture());n.anchor.set(.5),n.width=t*.8,n.height=this.symbolHeight*.9,n.x=0,n.y=(r-1)*this.symbolHeight,this.symbolsContainer.addChild(n),this.symbols.push(n)}this.mask=new u,this.symbolsContainer.mask=this.mask,this.addChild(this.mask),this.reelBg=new u,this.reelFrame=new u,this.winLine=new u,this.addChildAt(this.reelBg,0),this.addChild(this.reelFrame),this.addChild(this.winLine),this.symbolsContainer.y=0,this.spinning=!1,this.onStop=null,this.resize(t,e)}getRandomTexture(){return this.symbolTextures[Math.floor(Math.random()*this.symbolTextures.length)]}getCenterSprite(){return this.symbols[this.centerIndex]}startWinningAnimation(t){if(!t)return;let e=!0;t.rotation=0,t._winTicker=()=>{t.rotation+=.01;const i=t.scale.x;t.scale.set(e?Math.min(i+.01,1.1):Math.max(i-.01,.9)),i>=1.1&&(e=!1),i<=.9&&(e=!0)},c.shared.add(t._winTicker)}stopWinningAnimation(t){t?._winTicker&&(c.shared.remove(t._winTicker),delete t._winTicker,t.rotation=0,t.scale.set(1),t.alpha=1)}resize(t,e){this.symbolHeight=e/3,this.symbols.forEach((i,r)=>{i.width=t*.8,i.height=this.symbolHeight*.9,i.x=0,i.y=(r-1)*this.symbolHeight}),this.mask.clear(),this.mask.beginFill(16777215),this.mask.drawRect(-t/2,-e/2,t,e),this.mask.endFill(),this.reelBg.clear(),this.reelBg.beginFill(0,.75),this.reelBg.drawRoundedRect(-t/2,-e/2,t,e,15),this.reelBg.endFill(),this.reelFrame.clear(),this.reelFrame.lineStyle(3,16764006),this.reelFrame.drawRoundedRect(-t/2,-e/2,t,e,15),this.winLine.clear(),this.winLine.lineStyle(3,16764006),this.winLine.moveTo(-t/2+8,0),this.winLine.lineTo(t/2-8,0),this._pulsePhase=Math.random()*Math.PI*2,c.shared.add(()=>{this._pulsePhase+=.015;const i=.9+.1*Math.sin(this._pulsePhase);this.reelBg.alpha=i})}backout(t){return e=>--e*e*((t+1)*e+t)+1}startSpin(t=2500,e=20){this.spinning||(this.spinning=!0,this.startY=this.symbolsContainer.y,this.totalShift=e*this.symbolHeight,this.time=0,this.duration=t,c.shared.add(this.spinStep,this))}spinStep(t){this.time+=t*16.66;const e=Math.min(this.time/this.duration,1),i=this.backout(.5)(e);if(this.symbolsContainer.y=this.startY+this.totalShift*i,e<1){if(this.symbols[this.symbols.length-1].y+this.symbolsContainer.y>this.symbolHeight*2.5){const d=this.symbols.pop();d.texture=this.getRandomTexture();const m=this.symbols[0];d.y=m.y-this.symbolHeight,this.symbols.unshift(d)}}else c.shared.remove(this.spinStep,this),this.spinning=!1,typeof this.onStop=="function"&&this.onStop()}}class L{constructor(t,e={}){this.app=t,this.isPortrait=!1,this.screenW=0,this.screenH=0,this.options=e}updateOrientation(){this.screenW=this.app.screen.width,this.screenH=this.app.screen.height,this.isPortrait=this.screenH>this.screenW}getReelSize(){return{width:this.isPortrait?this.screenW/6:this.screenW/8,height:this.isPortrait?this.screenH*.35:this.screenH*.45}}getNeonPosition(){return{x:this.screenW/2,y:this.isPortrait?this.screenH*.12:this.screenH*.2,fontSize:Math.round(this.screenW*.06)}}getSpinButtonPosition(){return{x:this.screenW/2,y:this.isPortrait?this.screenH-90:this.screenH-60}}getSlotMachinePosition(t,e){return{x:(this.screenW-t*e)/2,y:this.isPortrait?this.screenH*.4:this.screenH*.5}}getBackgroundSize(){return{width:this.screenW,height:this.screenH}}}function E(){const h=new v({resizeTo:window,backgroundColor:0});document.body.appendChild(h.view);const t=new F(k.get("background"));h.stage.addChild(t);let e;document.fonts.load("64px Mexcellent").then(()=>{e=new z("Welcome",{fontFamily:"Mexcellent",fontSize:64,fill:65535,dropShadow:!0,dropShadowColor:65535,dropShadowBlur:15,dropShadowAngle:Math.PI/6,dropShadowDistance:6}),e.anchor.set(.5),e.x=h.screen.width/2,e.y=160,h.stage.addChild(e);let s=0;c.shared.add(()=>{s+=.02;const o=1+.05*Math.sin(s);e.scale.set(o),e.rotation=.02*Math.sin(s*2)})});const r=["bar","cherries","coconut","peach","pineapple","strawberry","threeBars","twoBars"].map(s=>k.get(s)),n=[],d=5,m=new H;h.stage.addChild(m);for(let s=0;s<d;s++){const o=new _({width:h.screen.width/8,height:h.screen.height*.45,symbolTextures:r});m.addChild(o),n.push(o)}const l=new H,y=new u;y.beginFill(16768358),y.drawRoundedRect(-80,-30,160,60,12),y.endFill();const b=new z("SPIN",{fontFamily:"Arial",fontWeight:"bold",fontSize:32,fill:9109504});b.anchor.set(.5),l.addChild(y,b),l.eventMode="static",l.buttonMode=!0,h.stage.addChild(l);let w=!1,P=0;const g=new L(h);function W(){g.updateOrientation();const{width:s,height:o}=g.getReelSize(),{width:x,height:S}=g.getBackgroundSize(),{x:f,y:C,fontSize:B}=g.getNeonPosition(),{x:a,y:p}=g.getSpinButtonPosition(),{x:M,y:R}=g.getSlotMachinePosition(s,d);t.width=x,t.height=S,e&&(e.x=f,e.y=C,e.style.fontSize=B),n.forEach((T,A)=>{T.resize(s,o),T.x=A*s+s/2,T.y=0}),m.x=M,m.y=R,l.x=a,l.y=p}W(),window.addEventListener("resize",()=>{h.renderer.resize(window.innerWidth,window.innerHeight),W()}),c.shared.add(()=>{if(w)y.alpha=.4,b.alpha=.4;else{P+=.05;const s=.85+.15*Math.sin(P);y.alpha=s,b.alpha=s}}),l.on("pointerdown",()=>{if(w)return;w=!0;let s=0;n.forEach((o,x)=>{const S=o.symbols.find(f=>{const C=f.y+o.symbolsContainer.y;return Math.abs(C)<o.symbolHeight*.6});S&&o.stopWinningAnimation(S),o.onStop=()=>{if(s++,s===n.length){w=!1;const f=n.map(a=>a.symbols.find(p=>{const M=p.y+a.symbolsContainer.y;return Math.abs(M)<a.symbolHeight*.6}));f[2]?.texture===k.get("threeBars")&&f.forEach((a,p)=>{a&&n[p].startWinningAnimation(a)})}},setTimeout(()=>o.startSpin(2e3+x*300,12),x*300)})})}export{E as startGame};
